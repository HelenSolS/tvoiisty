# Лаборатория (Lab)

Скрытая страница для тестирования примерки и видео на **двух провайдерах KIE**: основной и резервный. Нужна только на ветке **dev**.

---

## Что такое «основной» и «резервный»?

Это два набора настроек для запросов к KIE:

| Провайдер   | Переменные окружения        | Когда использовать |
|-------------|----------------------------|--------------------|
| **KIE основной** | `KIE_API_KEY`, `KIE_BASE_URL` (опционально) | Обычный прод/тест — основной аккаунт KIE (api.kie.ai). |
| **KIE резервный** | `KIE_BACKUP_API_KEY`, `KIE_BACKUP_BASE_URL` | Второй аккаунт KIE, другой инстанс API или стенд — чтобы сравнивать результаты или иметь запас при сбое основного. |

В Лаборатории можно **выбрать, куда отправить запрос** — основной или резервный — и сравнить время ответа и результат. В основном приложении (главный экран) используется только основной провайдер (или тот, что выбран в настройках).

---

## Как открыть Лабораторию

1. Открой приложение (локально или деплой с ветки **dev**).
2. Зайди в **Настройки** (иконка шестерёнки).
3. Внизу экрана есть малозаметная кнопка **⚗️ Lab** — нажми её.
4. Откроется экран «Лаборатория» с двумя шагами: **Шаг 1: Примерка** и **Шаг 2: Видео**.

---

## Как пользоваться

### Шаг 1 — Примерка

1. Загрузи **фото человека** (своё или тестовое) и **фото образа** (одежда).
2. Выбери **«KIE основной»** или **«KIE резервный»** (кнопки «Куда отправить»).
3. Нажми **«Запустить примерку»**.
4. Дождись результата: появится картинка, время в секундах и провайдер.
5. При желании нажми **«Сохранить эксперимент»** — результат попадёт в список внизу; по клику на сохранённую картинку можно снова подставить её в слоты и перезапустить.

### Шаг 2 — Видео

1. Выбери **источник картинки**: результат примерки из шага 1 или любое сохранённое изображение из списка; можно загрузить свою картинку.
2. Выбери провайдер: **KIE основной** или **KIE резервный**.
3. Нажми **«Создать видео»**.
4. Дождись видео: отобразится плеер, время и провайдер. Последние видео сохраняются в списке внизу.

Кнопка **«← Назад»** возвращает в Настройки.

---

## Как тестировать

- **Проверка основного провайдера:** выбери «KIE основной», загрузи человек + образ, запусти примерку и видео — убедись, что ответ приходит и картинка/видео отображаются.
- **Сравнение с резервным:** если заданы `KIE_BACKUP_BASE_URL` и `KIE_BACKUP_API_KEY`, повтори те же запросы с «KIE резервный» и сравни время и качество.
- **Сохранённые эксперименты:** сохрани несколько примерок/видео, проверь, что по клику они подставляются в слоты и можно снова запускать запросы.

Данные экспериментов хранятся в `localStorage` (ключи `tvoisty_lab_tryon`, `tvoisty_lab_video`) только в браузере.

---

## Резервный провайдер (опционально)

В **Vercel** или в локальном **.env** добавь:

```env
KIE_BACKUP_BASE_URL=https://api.kie.ai/api/v1
KIE_BACKUP_API_KEY=твой_второй_ключ
```

Если эти переменные не заданы, кнопка «KIE резервный» всё равно отображается, но запрос вернёт ошибку (нет ключа). Лаборатория нужна в первую очередь для сравнения двух конфигураций или для тестов на втором аккаунте/стенде.
